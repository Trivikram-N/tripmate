{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>TripMate | Home</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-light shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                TripMate
                <img src="https://cdn-icons-png.flaticon.com/512/201/201623.png" alt="icon" class="travel-image ms-2">
            </a>

            <div class="ms-auto">
                <a href="{% url 'liked' %}" class="btn btn-outline-primary me-2">‚ù§Ô∏è Liked</a>

                {% if user.is_authenticated %}
                <a href="{% url 'logout' %}" class="btn btn-primary">Logout</a>
                {% else %}
                <a href="{% url 'login' %}" class="btn btn-primary">Login</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <section class="hero text-center">
        <h1 class="display-3 fw-bold">Time to TRAVEL ‚úàÔ∏è</h1>
        <p class="lead">Plan, explore, and make your journey unforgettable üåç</p>
    </section>

    <!-- Intro Section -->
    <section class="container my-5 intro">
        <div class="row align-items-center">
            <div class="col-md-5">
                <img src="https://images.unsplash.com/photo-1526772662000-3f88f10405ff"
                    class="img-fluid rounded shadow" alt="Travel Intro">
            </div>
            <div class="col-md-7">
                <h2>Welcome to TripMate</h2>
                <p>Your personal travel assistant to help you discover dream destinations with ease.</p>
                <p>Choose what excites you ‚Äî beaches, mountains, cities, or cultural escapes.</p>
            </div>
        </div>
    </section>


    <section class="container my-5">

        <!-- Categories -->
        <h3 class="mb-3 text-center">Explore by Category</h3>

        <div class="category-list">
            {% for cat in categories %}
            <label>
                <input type="checkbox" class="cat-checkbox" value="{{ cat }}">
                <span>{{ cat }}</span>
            </label> 
            {% endfor %}
        </div>

        <!-- Locations -->
        <div id="destinationContainer" class="row row-cols-1 row-cols-md-3 g-4 mt-3">
            {% for place in places %}
            <div class="col place-card" data-category="{% for c in place.category.all %}{{ c.name }},{% endfor %}">
                <div class="card">
                    <a href="{% url 'destination-details' place.title %}">
                        <img src="{{ place.image.url }}" class="card-img-top" alt="{{ place.title }}">
                    </a>
                    <div class="card-body">
                        <h5>{{ place.title }}</h5>
                        <p>{{ place.description }}</p>

                        <button class="like-btn" data-id="{{ place.id }}">
                            {% if place in request.user.details.liked_places.all %}
                            üíñ
                            {% else %}
                            ü©∂
                            {% endif %}
                        </button>
                        
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

    </section>

    <footer class="bg-light text-center py-3">
        <p class="mb-0">&copy; 2025 TripMate | Designed for Travelers üåé</p>
    </footer>

    <script>

        // for likes
        document.querySelectorAll(".like-btn").forEach(btn => {
            btn.addEventListener("click", function () {
                const placeId = this.dataset.id;

                fetch(`/like/${placeId}/`)
                    .then(res => res.json())
                    .then(data => {

                        if (data.auth === false) {
                            window.location.href = "/login/?next=" + window.location.pathname;
                            return;
                        }

                        if (data.liked) {
                            this.textContent = "üíñ";  // show liked
                        } else {
                            this.textContent = "ü©∂";  // show unliked
                        }
                    });
                
            });
        });


        // for catagories
        document.addEventListener("DOMContentLoaded", function () {
            const checkboxes = document.querySelectorAll('.cat-checkbox');
            const cards = document.querySelectorAll('.place-card');

            function filterPlaces() {
                // Get list of selected categories
                const selected = Array.from(checkboxes)
                    .filter(cb => cb.checked)
                    .map(cb => cb.value.trim());

                if (selected.length === 0) { // if no categories selected
                    cards.forEach(card => {
                        card.style.display = "block";
                    });
                    return;
                }

                // Loop through each place card
                cards.forEach(card => {
                    const cardCats = card.dataset.category.split(',').map(c => c.trim());

                    // Check if ANY category of the place matches a selected category
                    const match = cardCats.some(cat => selected.includes(cat));

                    // Show/Hide card
                    card.style.display = match ? "block" : "none";
                });
            }

            // Attach listener to all checkboxes
            checkboxes.forEach(cb => cb.addEventListener('change', filterPlaces));

            // Run once on load
            filterPlaces();
        });
    </script>

</body>

</html>